<!doctype html>
<html>
	<!-- this page will likely be embedded somewhere else -->
	<head>
		<title>ManageMyCreditCard</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css">
		<link rel="stylesheet" href="main.css" />
		<script src="main.js"> </script>
		<style>
			#addCreditCard {
                text-align: right;
            }
		</style>

	</head>
	<body>
		<div class = "creditCard">
			<h2>Manage Credit Cards
			</h2>
			<form>
				<fieldset>
					<div class="row" id='manage-info'>
            					<div class="col-sm-12 col-md-4 col-lg-4">
                					<h1><button type="button" onclick="window.location.href ='index.html';">Home</button><h1>
            					</div>
           	 					<div class="col-sm-12 col-md-4 col-lg-4">
            					</div>
            					<div class="col-sm-12 col-md-4 col-lg-4" id="addCreditCard">
                					<h1><button type="button" onclick="window.location ='add-cc.html';">Add Credit Card</button><h1>
            					</div>
        				</div>

					<div class = "row">
						<table style="width:100%">
						  <tr>
						    <th>Address</th>
						    <th>Card Number</th>
						    <th>Action</th>
						  </tr>

						</table>


				</fieldset>
			</form>
			<script>

				let addresses = {};

				async function loadAddresses() {
					const ret = await cs425.api.get('/customer/address/list');
					const addrSel = document.getElementById("billing-addr");
					ret.forEach(addr =>
						addrSel.innerHTML += `<option value="${addr.addressId}">${addr.line1 + ' ' + addr.line2}</option>`);

				}

				(async function populateTable(){
					let resp;
					try {
						resp = await cs425.api.get("/customer/cc/list");
						console.log(resp);
					} catch (e) {
						console.error(e);
					}

					    ret = list(map(lambda t: {
					        "cardId" : t[0],
					        'addressId' : t[1],
					        'cardNumber' : t[2],
					        'expiration' : t[3],
					        'nameOnCard' : t[4],
					        'cvcCode' : t[5],
					    }, ret))
					const t = document.getElementById('manage-info');
					resp.cards.forEach(cc =>
						t.innerHTML += `<tr>
							<td>${cc.cardNumber}</td>
							<td>${cc.expiration}</td>
							<td>${cc.nameOnCard}</td>
							<td>${cc.cvcCode}</td>
							<td>${addresses[cc.addressId] || cc.addressId }</td>
						</tr>`
					);
				})();

				async function delete(id) {
					try {
						const resp = await cs425.api.post("/customer/cc/delete", { addressId : id });
						console.log(resp);
					} catch (e) {
						console.error(e);
					}
				}
			</script>
	</body>
</html>
